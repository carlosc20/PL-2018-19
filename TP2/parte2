#!/usr/bin/gawk -f


BEGIN  {
    RS="NIL";
    FS=";"
    nCod = 0;
    beginGrafo("grafo.dot");
}

NR > 1 {
    if($2~/([0-9]+\.?)+/){
        nCod++;
        print "Código: ",$2;
        print "Titulo: ",$3;
        print "Descrição: ",$4;
        if($27 != "")
            print "Notas: ",$27;
            
        print "\n";

        # 11 -> dono do processo, 12 -> participante do processo

        #Tipo
        if($10=="") 
            $10="Sem tipo";
        tipos[$10]++;

        #Diplomas juridico-administrativos 
        if($8!=""){
            split($8,leis,"#")
            printf ("\t\"%s\" -> {",$2) > "grafo.dot";
            for(l in leis){
                sub("\r\n","",leis[l]);
                sub("\"","",leis[l]);
                if(length(leis[l]) > 1) {
                    printf (" \"%s\"",leis[l]) > "grafo.dot";
                }
            }
            printf ("};\n") > "grafo.dot";
        }
    }
}

END {
    print "Número de registos:" nCod;
    for(tip in tipos)
        print tip, "->", tipos[tip], "ocorrências"; 
    endGrafo("grafo.dot");
}

function beginGrafo(n) {
    print "digraph {" > n;
    print "ratio = \"compress\"" > n;
    print "ranksep=5.75; size = \"8.3,11.7!\";" > n; # random cenas nem sei
    print "rankdir = LR;" > n;
}



function endGrafo(n) {
    print "}" > n;
}